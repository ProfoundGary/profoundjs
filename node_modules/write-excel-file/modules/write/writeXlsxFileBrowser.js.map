{"version":3,"file":"writeXlsxFileBrowser.js","names":["JSZip","FileSaver","getImageFileName","generateWorkbookXml","generateWorkbookXmlRels","rels","generateContentTypesXml","generateDrawingXml","generateDrawingXmlRels","generateSheetXmlRels","generateSharedStringsXml","generateStylesXml","generateSheets","writeXlsxFile","data","_ref","arguments","length","undefined","fileName","rest","_objectWithoutProperties","_excluded","generateXlsxFile","then","blob","saveAs","_ref2","sheetName","sheet","sheetNames","sheets","schema","columns","images","headerStyle","getHeaderStyle","fontFamily","fontSize","orientation","stickyRowsCount","stickyColumnsCount","showGridLines","rightToLeft","dateFormat","zip","_generateSheets","getSharedStrings","getStyles","file","xl","folder","_iterator","_createForOfIteratorHelperLoose","_step","done","_step$value","value","id","concat","sheetId","_iterator2","_step2","image","sheetImages","content","generateAsync","type","mimeType","compression"],"sources":["../../source/write/writeXlsxFileBrowser.js"],"sourcesContent":["// Copy-pasted from:\r\n// https://github.com/davidramos-om/zipcelx-on-steroids/blob/master/src/zipcelx.js\r\n\r\nimport JSZip from 'jszip'\r\nimport FileSaver from 'file-saver'\r\n\r\nimport getImageFileName from './getImageFileName.js'\r\n\r\nimport generateWorkbookXml from './files/workbook.xml.js'\r\nimport generateWorkbookXmlRels from './files/workbook.xml.rels.js'\r\nimport rels from './files/rels.js'\r\nimport generateContentTypesXml from './files/[Content_Types].xml.js'\r\nimport generateDrawingXml from './files/drawing.xml.js'\r\nimport generateDrawingXmlRels from './files/drawing.xml.rels.js'\r\nimport generateSheetXmlRels from './files/sheet.xml.rels.js'\r\nimport generateSharedStringsXml from './files/sharedStrings.xml.js'\r\nimport generateStylesXml from './files/styles.xml.js'\r\n\r\nimport { generateSheets } from './writeXlsxFile.common.js'\r\n\r\nexport default function writeXlsxFile(data, { fileName, ...rest } = {}) {\r\n  return generateXlsxFile(data, rest).then((blob) => {\r\n    if (fileName) {\r\n      return FileSaver.saveAs(blob, fileName)\r\n    }\r\n    return blob\r\n  })\r\n}\r\n\r\n/**\r\n * Writes an *.xlsx file into a \"blob\".\r\n * https://github.com/egeriis/zipcelx/issues/68\r\n * \"The reason if you want to send the excel file or store it natively on Cordova/capacitor app\".\r\n * @return {Blob}\r\n */\r\nfunction generateXlsxFile(data, {\r\n  sheet: sheetName,\r\n  sheets: sheetNames,\r\n  schema,\r\n  columns,\r\n  images,\r\n  headerStyle,\r\n  getHeaderStyle,\r\n  fontFamily,\r\n  fontSize,\r\n  orientation,\r\n  stickyRowsCount,\r\n  stickyColumnsCount,\r\n  showGridLines,\r\n  rightToLeft,\r\n  dateFormat\r\n}) {\r\n  const zip = new JSZip()\r\n\r\n  const {\r\n    sheets,\r\n    getSharedStrings,\r\n    getStyles\r\n  } = generateSheets({\r\n    data,\r\n    sheetName,\r\n    sheetNames,\r\n    schema,\r\n    columns,\r\n    images,\r\n    headerStyle,\r\n    getHeaderStyle,\r\n    fontFamily,\r\n    fontSize,\r\n    orientation,\r\n    stickyRowsCount,\r\n    stickyColumnsCount,\r\n    showGridLines,\r\n    rightToLeft,\r\n    dateFormat\r\n  })\r\n\r\n  zip.file('_rels/.rels', rels)\r\n\r\n  zip.file('[Content_Types].xml', generateContentTypesXml({ images, sheets }))\r\n\r\n  const xl = zip.folder('xl')\r\n  xl.file('_rels/workbook.xml.rels', generateWorkbookXmlRels({ sheets }))\r\n  xl.file('workbook.xml', generateWorkbookXml({ sheets, stickyRowsCount, stickyColumnsCount }))\r\n  xl.file('styles.xml', generateStylesXml(getStyles()))\r\n  xl.file('sharedStrings.xml', generateSharedStringsXml(getSharedStrings()))\r\n\r\n  for (const { id, data, images } of sheets) {\r\n    xl.file(`worksheets/sheet${id}.xml`, data)\r\n    xl.file(`worksheets/_rels/sheet${id}.xml.rels`, generateSheetXmlRels({ id, images }))\r\n    if (images) {\r\n      xl.file(`drawings/drawing${id}.xml`, generateDrawingXml({ images }))\r\n      xl.file(`drawings/_rels/drawing${id}.xml.rels`, generateDrawingXmlRels({ images, sheetId: id }))\r\n      // Copy images to `xl/media` folder.\r\n      for (const image of images) {\r\n        // According to `JSZip` docs:\r\n        // https://stuk.github.io/jszip/documentation/api_jszip/file_data.html\r\n        // `.file()` function supports `data` argument of type:\r\n        // * String\r\n        // * ArrayBuffer\r\n        // * Uint8Array\r\n        // * Buffer\r\n        // * Blob\r\n        // * Promise\r\n        // * Nodejs stream\r\n        xl.file(`media/${getImageFileName(image, { sheetId: id, sheetImages: images })}`, image.content)\r\n      }\r\n    }\r\n  }\r\n\r\n  return zip.generateAsync({\r\n    type: 'blob',\r\n    mimeType: 'application/vnd.openxmlformats-officedocument.spreadsheetml.sheet',\r\n    compression: 'deflate'\r\n  })\r\n}"],"mappings":"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","ignoreList":[]}