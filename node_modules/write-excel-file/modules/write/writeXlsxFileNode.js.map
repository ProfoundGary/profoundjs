{"version":3,"file":"writeXlsxFileNode.js","names":["fs","path","os","Stream","Readable","Archive","getImageFileName","generateWorkbookXml","generateWorkbookXmlRels","rels","generateContentTypesXml","generateDrawingXml","generateDrawingXmlRels","generateSheetXmlRels","generateSharedStringsXml","generateStylesXml","generateSheets","writeXlsxFile","_x","_writeXlsxFile","apply","arguments","_asyncToGenerator","_regeneratorRuntime","mark","_callee","data","_ref","filePath","buffer","sheetName","sheetNames","schema","columns","images","headerStyle","getHeaderStyle","fontFamily","fontSize","orientation","stickyRowsCount","stickyColumnsCount","showGridLines","rightToLeft","dateFormat","archive","_generateSheets","sheets","getSharedStrings","getStyles","root","xl","mediaPath","drawingsPath","drawingsRelsPath","_rels","worksheetsPath","worksheetsRelsPath","promises","_iterator2","_step2","_step2$value","id","_data","_images","_iterator3","_step3","image","imageContentReadableStream","imageFilePath","_args","wrap","_callee$","_context","prev","next","length","undefined","sheet","createTempDirectory","sent","createDirectory","join","writeFile","_createForOfIteratorHelperLoose","done","value","push","concat","sheetId","getReadableStream","content","sheetImages","writeFileFromStream","Promise","all","directory","append","write","removeDirectoryWithLegacyNodeVersionsSupport","abrupt","streamToBuffer","stop","contents","resolve","reject","error","mkdir","mkdtemp","tmpdir","directoryPath","rm","removeDirectory","removeDirectoryLegacySync","recursive","force","childNames","readdirSync","_iterator","_step","childName","childPath","stats","statSync","isDirectory","unlinkSync","rmdirSync","stream","chunks","on","chunk","Buffer","copyFile","fromPath","toPath","source","from","createReadStream","Error","readableStream","writableStream","createWriteStream","pipe"],"sources":["../../source/write/writeXlsxFileNode.js"],"sourcesContent":["import fs from 'fs'\r\nimport path from 'path'\r\nimport os from 'os'\r\nimport Stream, { Readable } from 'stream'\r\n\r\nimport Archive from './archive.js'\r\nimport getImageFileName from './getImageFileName.js'\r\n\r\nimport generateWorkbookXml from './files/workbook.xml.js'\r\nimport generateWorkbookXmlRels from './files/workbook.xml.rels.js'\r\nimport rels from './files/rels.js'\r\nimport generateContentTypesXml from './files/[Content_Types].xml.js'\r\nimport generateDrawingXml from './files/drawing.xml.js'\r\nimport generateDrawingXmlRels from './files/drawing.xml.rels.js'\r\nimport generateSheetXmlRels from './files/sheet.xml.rels.js'\r\nimport generateSharedStringsXml from './files/sharedStrings.xml.js'\r\nimport generateStylesXml from './files/styles.xml.js'\r\n\r\nimport { generateSheets } from './writeXlsxFile.common.js'\r\n\r\nexport default async function writeXlsxFile(data, {\r\n\tfilePath,\r\n\tbuffer,\r\n\tsheet: sheetName,\r\n\tsheets: sheetNames,\r\n\tschema,\r\n\tcolumns,\r\n\timages,\r\n\theaderStyle,\r\n\tgetHeaderStyle,\r\n\tfontFamily,\r\n\tfontSize,\r\n\torientation,\r\n\tstickyRowsCount,\r\n\tstickyColumnsCount,\r\n\tshowGridLines,\r\n\trightToLeft,\r\n\tdateFormat\r\n} = {}) {\r\n\t// I dunno why it uses `Archive` here instead of something like `JSZip`\r\n\t// that is used in `writeXlsxFileBrowser.js`.\r\n\tconst archive = new Archive(filePath)\r\n\r\n\tconst {\r\n\t\tsheets,\r\n\t\tgetSharedStrings,\r\n\t\tgetStyles\r\n\t} = generateSheets({\r\n\t\tdata,\r\n\t\tsheetName,\r\n\t\tsheetNames,\r\n\t\tschema,\r\n\t\tcolumns,\r\n\t\timages,\r\n\t\theaderStyle,\r\n\t\tgetHeaderStyle,\r\n\t\tfontFamily,\r\n\t\tfontSize,\r\n\t\torientation,\r\n\t\tstickyRowsCount,\r\n\t\tstickyColumnsCount,\r\n\t\tshowGridLines,\r\n\t\trightToLeft,\r\n\t\tdateFormat\r\n\t})\r\n\r\n\t// There doesn't seem to be a way to just append a file into a subdirectory\r\n\t// in `archiver` library, hence using a hacky temporary directory workaround.\r\n\t// https://www.npmjs.com/package/archiver\r\n\tconst root = await createTempDirectory()\r\n\tconst xl = await createDirectory(path.join(root, 'xl'))\r\n\tconst mediaPath = await createDirectory(path.join(xl, 'media'))\r\n\tconst drawingsPath = await createDirectory(path.join(xl, 'drawings'))\r\n\tconst drawingsRelsPath = await createDirectory(path.join(drawingsPath, '_rels'))\r\n\tconst _rels = await createDirectory(path.join(xl, '_rels'))\r\n\tconst worksheetsPath = await createDirectory(path.join(xl, 'worksheets'))\r\n\tconst worksheetsRelsPath = await createDirectory(path.join(worksheetsPath, '_rels'))\r\n\r\n\tconst promises = [\r\n\t\twriteFile(path.join(_rels, 'workbook.xml.rels'), generateWorkbookXmlRels({ sheets })),\r\n\t\twriteFile(path.join(xl, 'workbook.xml'), generateWorkbookXml({ sheets, stickyRowsCount, stickyColumnsCount })),\r\n\t\twriteFile(path.join(xl, 'styles.xml'), generateStylesXml(getStyles())),\r\n\t\twriteFile(path.join(xl, 'sharedStrings.xml'), generateSharedStringsXml(getSharedStrings()))\r\n\t]\r\n\r\n\tfor (const { id, data, images } of sheets) {\r\n\t\tpromises.push(writeFile(path.join(worksheetsPath, `sheet${id}.xml`), data))\r\n\t\tpromises.push(writeFile(path.join(worksheetsRelsPath, `sheet${id}.xml.rels`), generateSheetXmlRels({ id, images })))\r\n\t\tif (images) {\r\n\t\t\tpromises.push(writeFile(path.join(drawingsPath, `drawing${id}.xml`), generateDrawingXml({ images })))\r\n\t\t\tpromises.push(writeFile(path.join(drawingsRelsPath, `drawing${id}.xml.rels`), generateDrawingXmlRels({ images, sheetId: id })))\r\n\t\t\t// Copy images to `xl/media` folder.\r\n\t\t\tfor (const image of images) {\r\n\t\t\t\tconst imageContentReadableStream = getReadableStream(image.content)\r\n\t\t\t\tconst imageFilePath = path.join(mediaPath, getImageFileName(image, { sheetId: id, sheetImages: images }))\r\n\t\t\t\tpromises.push(writeFileFromStream(imageFilePath, imageContentReadableStream))\r\n\t\t\t}\r\n\t\t}\r\n\t}\r\n\r\n\tawait Promise.all(promises)\r\n\r\n\tarchive.directory(xl, 'xl')\r\n\r\n\tarchive.append(rels, '_rels/.rels')\r\n\r\n  archive.append(generateContentTypesXml({ images, sheets }), '[Content_Types].xml')\r\n\r\n\tif (filePath) {\r\n\t\tawait archive.write()\r\n\t\tawait removeDirectoryWithLegacyNodeVersionsSupport(root)\r\n\t} else if (buffer) {\r\n\t\treturn streamToBuffer(archive.write())\r\n\t} else {\r\n\t\treturn archive.write()\r\n\t}\r\n}\r\n\r\n// According to Node.js docs:\r\n// https://nodejs.org/api/fs.html#fswritefilefile-data-options-callback\r\n// `contents` argument could be of type:\r\n// * string â€” File path\r\n// * Buffer\r\n// * TypedArray\r\n// * DataView\r\nfunction writeFile(path, contents) {\r\n\treturn new Promise((resolve, reject) => {\r\n\t\tfs.writeFile(path, contents, 'utf-8', (error) => {\r\n\t\t\tif (error) {\r\n\t\t\t\treturn reject(error)\r\n\t\t\t}\r\n\t\t\tresolve()\r\n\t\t})\r\n\t})\r\n}\r\n\r\nfunction createDirectory(path) {\r\n\treturn new Promise((resolve, reject) => {\r\n\t\tfs.mkdir(path, (error) => {\r\n\t\t\tif (error) {\r\n\t\t\t\treturn reject(error)\r\n\t\t\t}\r\n\t\t\tresolve(path)\r\n\t\t})\r\n\t})\r\n}\r\n\r\nfunction createTempDirectory() {\r\n\treturn new Promise((resolve, reject) => {\r\n\t\tfs.mkdtemp(path.join(os.tmpdir(), 'write-excel-file-'), (error, directoryPath) => {\r\n\t\t\tif (error) {\r\n\t\t\t\treturn reject(error)\r\n\t\t\t}\r\n\t\t\tresolve(directoryPath)\r\n\t\t})\r\n\t})\r\n}\r\n\r\nfunction removeDirectoryWithLegacyNodeVersionsSupport(path) {\r\n\tif (fs.rm) {\r\n\t\treturn removeDirectory(path)\r\n\t} else {\r\n\t\tremoveDirectoryLegacySync(path)\r\n  \treturn Promise.resolve()\r\n\t}\r\n}\r\n\r\n// `fs.rm()` is available in Node.js since `14.14.0`.\r\nfunction removeDirectory(path) {\r\n\treturn new Promise((resolve, reject) => {\r\n\t\tfs.rm(path, { recursive: true, force: true }, (error) => {\r\n\t\t\tif (error) {\r\n\t\t\t\treturn reject(error)\r\n\t\t\t}\r\n\t\t\tresolve()\r\n\t\t})\r\n\t})\r\n}\r\n\r\n// For Node.js versions below `14.14.0`.\r\nfunction removeDirectoryLegacySync(directoryPath) {\r\n  const childNames = fs.readdirSync(directoryPath)\r\n  for (const childName of childNames) {\r\n    const childPath = path.join(directoryPath, childName)\r\n    const stats = fs.statSync(childPath)\r\n    if (childPath === '.' || childPath === '..') {\r\n      // Skip.\r\n    } else if (stats.isDirectory()) {\r\n      // Remove subdirectory recursively.\r\n      removeDirectoryLegacySync(childPath)\r\n    } else {\r\n      // Remove file.\r\n      fs.unlinkSync(childPath)\r\n    }\r\n  }\r\n  fs.rmdirSync(directoryPath)\r\n}\r\n\r\n// https://stackoverflow.com/a/67729663\r\nfunction streamToBuffer(stream) {\r\n\treturn new Promise((resolve, reject) => {\r\n\t\tconst chunks = []\r\n\t\tstream.on('data', (chunk) => chunks.push(chunk))\r\n\t\tstream.on('end', () => resolve(Buffer.concat(chunks)))\r\n\t\tstream.on('error', reject)\r\n\t})\r\n}\r\n\r\nfunction copyFile(fromPath, toPath) {\r\n\treturn new Promise((resolve, reject) => {\r\n\t\tfs.copyFile(fromPath, toPath, (error) => {\r\n\t\t\tif (error) {\r\n\t\t\t\treturn reject(error)\r\n\t\t\t}\r\n\t\t\tresolve()\r\n\t\t})\r\n\t})\r\n}\r\n\r\nfunction getReadableStream(source) {\r\n\tif (source instanceof Stream) {\r\n\t\treturn source\r\n\t}\r\n\tif (source instanceof Buffer) {\r\n\t\treturn Readable.from(source)\r\n\t}\r\n\tif (typeof source === 'string') {\r\n\t\treturn fs.createReadStream(source)\r\n\t}\r\n\tthrow new Error('Unsupported content source: couldn\\'t convert it to a readable stream')\r\n}\r\n\r\nfunction writeFileFromStream(filePath, readableStream) {\r\n\tconst writableStream = fs.createWriteStream(filePath)\r\n\treadableStream.pipe(writableStream)\r\n\treturn new Promise(resolve => writableStream.on('finish', resolve))\r\n}"],"mappings":"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","ignoreList":[]}