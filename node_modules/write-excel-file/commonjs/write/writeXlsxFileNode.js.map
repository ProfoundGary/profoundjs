{"version":3,"file":"writeXlsxFileNode.js","names":["_fs","_interopRequireDefault","require","_path","_os","_stream","_interopRequireWildcard","_archive","_getImageFileName","_workbookXml","_workbookXmlRels","_rels2","_Content_TypesXml","_drawingXml","_drawingXmlRels","_sheetXmlRels","_sharedStringsXml","_stylesXml","_writeXlsxFileCommon","_getRequireWildcardCache","e","WeakMap","r","t","__esModule","_typeof","has","get","n","__proto__","a","Object","defineProperty","getOwnPropertyDescriptor","u","hasOwnProperty","call","i","set","_createForOfIteratorHelperLoose","Symbol","iterator","next","bind","Array","isArray","_unsupportedIterableToArray","length","o","done","value","TypeError","_arrayLikeToArray","toString","slice","constructor","name","from","test","writeXlsxFile","_x","_writeXlsxFile","apply","arguments","_asyncToGenerator2","_regenerator","mark","_callee","data","_ref","filePath","buffer","sheetName","sheetNames","schema","columns","images","headerStyle","getHeaderStyle","fontFamily","fontSize","orientation","stickyRowsCount","stickyColumnsCount","showGridLines","rightToLeft","dateFormat","archive","_generateSheets","sheets","getSharedStrings","getStyles","root","xl","mediaPath","drawingsPath","drawingsRelsPath","_rels","worksheetsPath","worksheetsRelsPath","promises","_iterator2","_step2","_step2$value","id","_data","_images","_iterator3","_step3","image","imageContentReadableStream","imageFilePath","_args","wrap","_callee$","_context","prev","undefined","sheet","Archive","generateSheets","createTempDirectory","sent","createDirectory","path","join","writeFile","generateWorkbookXmlRels","generateWorkbookXml","generateStylesXml","generateSharedStringsXml","push","concat","generateSheetXmlRels","generateDrawingXml","generateDrawingXmlRels","sheetId","getReadableStream","content","getImageFileName","sheetImages","writeFileFromStream","Promise","all","directory","append","rels","generateContentTypesXml","write","removeDirectoryWithLegacyNodeVersionsSupport","abrupt","streamToBuffer","stop","contents","resolve","reject","fs","error","mkdir","mkdtemp","os","tmpdir","directoryPath","rm","removeDirectory","removeDirectoryLegacySync","recursive","force","childNames","readdirSync","_iterator","_step","childName","childPath","stats","statSync","isDirectory","unlinkSync","rmdirSync","stream","chunks","on","chunk","Buffer","copyFile","fromPath","toPath","source","Stream","Readable","createReadStream","Error","readableStream","writableStream","createWriteStream","pipe"],"sources":["../../source/write/writeXlsxFileNode.js"],"sourcesContent":["import fs from 'fs'\r\nimport path from 'path'\r\nimport os from 'os'\r\nimport Stream, { Readable } from 'stream'\r\n\r\nimport Archive from './archive.js'\r\nimport getImageFileName from './getImageFileName.js'\r\n\r\nimport generateWorkbookXml from './files/workbook.xml.js'\r\nimport generateWorkbookXmlRels from './files/workbook.xml.rels.js'\r\nimport rels from './files/rels.js'\r\nimport generateContentTypesXml from './files/[Content_Types].xml.js'\r\nimport generateDrawingXml from './files/drawing.xml.js'\r\nimport generateDrawingXmlRels from './files/drawing.xml.rels.js'\r\nimport generateSheetXmlRels from './files/sheet.xml.rels.js'\r\nimport generateSharedStringsXml from './files/sharedStrings.xml.js'\r\nimport generateStylesXml from './files/styles.xml.js'\r\n\r\nimport { generateSheets } from './writeXlsxFile.common.js'\r\n\r\nexport default async function writeXlsxFile(data, {\r\n\tfilePath,\r\n\tbuffer,\r\n\tsheet: sheetName,\r\n\tsheets: sheetNames,\r\n\tschema,\r\n\tcolumns,\r\n\timages,\r\n\theaderStyle,\r\n\tgetHeaderStyle,\r\n\tfontFamily,\r\n\tfontSize,\r\n\torientation,\r\n\tstickyRowsCount,\r\n\tstickyColumnsCount,\r\n\tshowGridLines,\r\n\trightToLeft,\r\n\tdateFormat\r\n} = {}) {\r\n\t// I dunno why it uses `Archive` here instead of something like `JSZip`\r\n\t// that is used in `writeXlsxFileBrowser.js`.\r\n\tconst archive = new Archive(filePath)\r\n\r\n\tconst {\r\n\t\tsheets,\r\n\t\tgetSharedStrings,\r\n\t\tgetStyles\r\n\t} = generateSheets({\r\n\t\tdata,\r\n\t\tsheetName,\r\n\t\tsheetNames,\r\n\t\tschema,\r\n\t\tcolumns,\r\n\t\timages,\r\n\t\theaderStyle,\r\n\t\tgetHeaderStyle,\r\n\t\tfontFamily,\r\n\t\tfontSize,\r\n\t\torientation,\r\n\t\tstickyRowsCount,\r\n\t\tstickyColumnsCount,\r\n\t\tshowGridLines,\r\n\t\trightToLeft,\r\n\t\tdateFormat\r\n\t})\r\n\r\n\t// There doesn't seem to be a way to just append a file into a subdirectory\r\n\t// in `archiver` library, hence using a hacky temporary directory workaround.\r\n\t// https://www.npmjs.com/package/archiver\r\n\tconst root = await createTempDirectory()\r\n\tconst xl = await createDirectory(path.join(root, 'xl'))\r\n\tconst mediaPath = await createDirectory(path.join(xl, 'media'))\r\n\tconst drawingsPath = await createDirectory(path.join(xl, 'drawings'))\r\n\tconst drawingsRelsPath = await createDirectory(path.join(drawingsPath, '_rels'))\r\n\tconst _rels = await createDirectory(path.join(xl, '_rels'))\r\n\tconst worksheetsPath = await createDirectory(path.join(xl, 'worksheets'))\r\n\tconst worksheetsRelsPath = await createDirectory(path.join(worksheetsPath, '_rels'))\r\n\r\n\tconst promises = [\r\n\t\twriteFile(path.join(_rels, 'workbook.xml.rels'), generateWorkbookXmlRels({ sheets })),\r\n\t\twriteFile(path.join(xl, 'workbook.xml'), generateWorkbookXml({ sheets, stickyRowsCount, stickyColumnsCount })),\r\n\t\twriteFile(path.join(xl, 'styles.xml'), generateStylesXml(getStyles())),\r\n\t\twriteFile(path.join(xl, 'sharedStrings.xml'), generateSharedStringsXml(getSharedStrings()))\r\n\t]\r\n\r\n\tfor (const { id, data, images } of sheets) {\r\n\t\tpromises.push(writeFile(path.join(worksheetsPath, `sheet${id}.xml`), data))\r\n\t\tpromises.push(writeFile(path.join(worksheetsRelsPath, `sheet${id}.xml.rels`), generateSheetXmlRels({ id, images })))\r\n\t\tif (images) {\r\n\t\t\tpromises.push(writeFile(path.join(drawingsPath, `drawing${id}.xml`), generateDrawingXml({ images })))\r\n\t\t\tpromises.push(writeFile(path.join(drawingsRelsPath, `drawing${id}.xml.rels`), generateDrawingXmlRels({ images, sheetId: id })))\r\n\t\t\t// Copy images to `xl/media` folder.\r\n\t\t\tfor (const image of images) {\r\n\t\t\t\tconst imageContentReadableStream = getReadableStream(image.content)\r\n\t\t\t\tconst imageFilePath = path.join(mediaPath, getImageFileName(image, { sheetId: id, sheetImages: images }))\r\n\t\t\t\tpromises.push(writeFileFromStream(imageFilePath, imageContentReadableStream))\r\n\t\t\t}\r\n\t\t}\r\n\t}\r\n\r\n\tawait Promise.all(promises)\r\n\r\n\tarchive.directory(xl, 'xl')\r\n\r\n\tarchive.append(rels, '_rels/.rels')\r\n\r\n  archive.append(generateContentTypesXml({ images, sheets }), '[Content_Types].xml')\r\n\r\n\tif (filePath) {\r\n\t\tawait archive.write()\r\n\t\tawait removeDirectoryWithLegacyNodeVersionsSupport(root)\r\n\t} else if (buffer) {\r\n\t\treturn streamToBuffer(archive.write())\r\n\t} else {\r\n\t\treturn archive.write()\r\n\t}\r\n}\r\n\r\n// According to Node.js docs:\r\n// https://nodejs.org/api/fs.html#fswritefilefile-data-options-callback\r\n// `contents` argument could be of type:\r\n// * string â€” File path\r\n// * Buffer\r\n// * TypedArray\r\n// * DataView\r\nfunction writeFile(path, contents) {\r\n\treturn new Promise((resolve, reject) => {\r\n\t\tfs.writeFile(path, contents, 'utf-8', (error) => {\r\n\t\t\tif (error) {\r\n\t\t\t\treturn reject(error)\r\n\t\t\t}\r\n\t\t\tresolve()\r\n\t\t})\r\n\t})\r\n}\r\n\r\nfunction createDirectory(path) {\r\n\treturn new Promise((resolve, reject) => {\r\n\t\tfs.mkdir(path, (error) => {\r\n\t\t\tif (error) {\r\n\t\t\t\treturn reject(error)\r\n\t\t\t}\r\n\t\t\tresolve(path)\r\n\t\t})\r\n\t})\r\n}\r\n\r\nfunction createTempDirectory() {\r\n\treturn new Promise((resolve, reject) => {\r\n\t\tfs.mkdtemp(path.join(os.tmpdir(), 'write-excel-file-'), (error, directoryPath) => {\r\n\t\t\tif (error) {\r\n\t\t\t\treturn reject(error)\r\n\t\t\t}\r\n\t\t\tresolve(directoryPath)\r\n\t\t})\r\n\t})\r\n}\r\n\r\nfunction removeDirectoryWithLegacyNodeVersionsSupport(path) {\r\n\tif (fs.rm) {\r\n\t\treturn removeDirectory(path)\r\n\t} else {\r\n\t\tremoveDirectoryLegacySync(path)\r\n  \treturn Promise.resolve()\r\n\t}\r\n}\r\n\r\n// `fs.rm()` is available in Node.js since `14.14.0`.\r\nfunction removeDirectory(path) {\r\n\treturn new Promise((resolve, reject) => {\r\n\t\tfs.rm(path, { recursive: true, force: true }, (error) => {\r\n\t\t\tif (error) {\r\n\t\t\t\treturn reject(error)\r\n\t\t\t}\r\n\t\t\tresolve()\r\n\t\t})\r\n\t})\r\n}\r\n\r\n// For Node.js versions below `14.14.0`.\r\nfunction removeDirectoryLegacySync(directoryPath) {\r\n  const childNames = fs.readdirSync(directoryPath)\r\n  for (const childName of childNames) {\r\n    const childPath = path.join(directoryPath, childName)\r\n    const stats = fs.statSync(childPath)\r\n    if (childPath === '.' || childPath === '..') {\r\n      // Skip.\r\n    } else if (stats.isDirectory()) {\r\n      // Remove subdirectory recursively.\r\n      removeDirectoryLegacySync(childPath)\r\n    } else {\r\n      // Remove file.\r\n      fs.unlinkSync(childPath)\r\n    }\r\n  }\r\n  fs.rmdirSync(directoryPath)\r\n}\r\n\r\n// https://stackoverflow.com/a/67729663\r\nfunction streamToBuffer(stream) {\r\n\treturn new Promise((resolve, reject) => {\r\n\t\tconst chunks = []\r\n\t\tstream.on('data', (chunk) => chunks.push(chunk))\r\n\t\tstream.on('end', () => resolve(Buffer.concat(chunks)))\r\n\t\tstream.on('error', reject)\r\n\t})\r\n}\r\n\r\nfunction copyFile(fromPath, toPath) {\r\n\treturn new Promise((resolve, reject) => {\r\n\t\tfs.copyFile(fromPath, toPath, (error) => {\r\n\t\t\tif (error) {\r\n\t\t\t\treturn reject(error)\r\n\t\t\t}\r\n\t\t\tresolve()\r\n\t\t})\r\n\t})\r\n}\r\n\r\nfunction getReadableStream(source) {\r\n\tif (source instanceof Stream) {\r\n\t\treturn source\r\n\t}\r\n\tif (source instanceof Buffer) {\r\n\t\treturn Readable.from(source)\r\n\t}\r\n\tif (typeof source === 'string') {\r\n\t\treturn fs.createReadStream(source)\r\n\t}\r\n\tthrow new Error('Unsupported content source: couldn\\'t convert it to a readable stream')\r\n}\r\n\r\nfunction writeFileFromStream(filePath, readableStream) {\r\n\tconst writableStream = fs.createWriteStream(filePath)\r\n\treadableStream.pipe(writableStream)\r\n\treturn new Promise(resolve => writableStream.on('finish', resolve))\r\n}"],"mappings":";;;;;;;;;;AAAA,IAAAA,GAAA,GAAAC,sBAAA,CAAAC,OAAA;AACA,IAAAC,KAAA,GAAAF,sBAAA,CAAAC,OAAA;AACA,IAAAE,GAAA,GAAAH,sBAAA,CAAAC,OAAA;AACA,IAAAG,OAAA,GAAAC,uBAAA,CAAAJ,OAAA;AAEA,IAAAK,QAAA,GAAAN,sBAAA,CAAAC,OAAA;AACA,IAAAM,iBAAA,GAAAP,sBAAA,CAAAC,OAAA;AAEA,IAAAO,YAAA,GAAAR,sBAAA,CAAAC,OAAA;AACA,IAAAQ,gBAAA,GAAAT,sBAAA,CAAAC,OAAA;AACA,IAAAS,MAAA,GAAAV,sBAAA,CAAAC,OAAA;AACA,IAAAU,iBAAA,GAAAX,sBAAA,CAAAC,OAAA;AACA,IAAAW,WAAA,GAAAZ,sBAAA,CAAAC,OAAA;AACA,IAAAY,eAAA,GAAAb,sBAAA,CAAAC,OAAA;AACA,IAAAa,aAAA,GAAAd,sBAAA,CAAAC,OAAA;AACA,IAAAc,iBAAA,GAAAf,sBAAA,CAAAC,OAAA;AACA,IAAAe,UAAA,GAAAhB,sBAAA,CAAAC,OAAA;AAEA,IAAAgB,oBAAA,GAAAhB,OAAA;AAA0D,SAAAiB,yBAAAC,CAAA,6BAAAC,OAAA,mBAAAC,CAAA,OAAAD,OAAA,IAAAE,CAAA,OAAAF,OAAA,YAAAF,wBAAA,YAAAA,yBAAAC,CAAA,WAAAA,CAAA,GAAAG,CAAA,GAAAD,CAAA,KAAAF,CAAA;AAAA,SAAAd,wBAAAc,CAAA,EAAAE,CAAA,SAAAA,CAAA,IAAAF,CAAA,IAAAA,CAAA,CAAAI,UAAA,SAAAJ,CAAA,eAAAA,CAAA,gBAAAK,OAAA,CAAAL,CAAA,0BAAAA,CAAA,sBAAAA,CAAA,QAAAG,CAAA,GAAAJ,wBAAA,CAAAG,CAAA,OAAAC,CAAA,IAAAA,CAAA,CAAAG,GAAA,CAAAN,CAAA,UAAAG,CAAA,CAAAI,GAAA,CAAAP,CAAA,OAAAQ,CAAA,KAAAC,SAAA,UAAAC,CAAA,GAAAC,MAAA,CAAAC,cAAA,IAAAD,MAAA,CAAAE,wBAAA,WAAAC,CAAA,IAAAd,CAAA,oBAAAc,CAAA,OAAAC,cAAA,CAAAC,IAAA,CAAAhB,CAAA,EAAAc,CAAA,SAAAG,CAAA,GAAAP,CAAA,GAAAC,MAAA,CAAAE,wBAAA,CAAAb,CAAA,EAAAc,CAAA,UAAAG,CAAA,KAAAA,CAAA,CAAAV,GAAA,IAAAU,CAAA,CAAAC,GAAA,IAAAP,MAAA,CAAAC,cAAA,CAAAJ,CAAA,EAAAM,CAAA,EAAAG,CAAA,IAAAT,CAAA,CAAAM,CAAA,IAAAd,CAAA,CAAAc,CAAA,YAAAN,CAAA,cAAAR,CAAA,EAAAG,CAAA,IAAAA,CAAA,CAAAe,GAAA,CAAAlB,CAAA,EAAAQ,CAAA,GAAAA,CAAA;AAAA,SAAAW,gCAAAjB,CAAA,EAAAF,CAAA,QAAAG,CAAA,yBAAAiB,MAAA,IAAAlB,CAAA,CAAAkB,MAAA,CAAAC,QAAA,KAAAnB,CAAA,oBAAAC,CAAA,UAAAA,CAAA,GAAAA,CAAA,CAAAa,IAAA,CAAAd,CAAA,GAAAoB,IAAA,CAAAC,IAAA,CAAApB,CAAA,OAAAqB,KAAA,CAAAC,OAAA,CAAAvB,CAAA,MAAAC,CAAA,GAAAuB,2BAAA,CAAAxB,CAAA,MAAAF,CAAA,IAAAE,CAAA,uBAAAA,CAAA,CAAAyB,MAAA,IAAAxB,CAAA,KAAAD,CAAA,GAAAC,CAAA,OAAAyB,CAAA,kCAAAA,CAAA,IAAA1B,CAAA,CAAAyB,MAAA,KAAAE,IAAA,WAAAA,IAAA,MAAAC,KAAA,EAAA5B,CAAA,CAAA0B,CAAA,sBAAAG,SAAA;AAAA,SAAAL,4BAAAxB,CAAA,EAAAQ,CAAA,QAAAR,CAAA,2BAAAA,CAAA,SAAA8B,iBAAA,CAAA9B,CAAA,EAAAQ,CAAA,OAAAP,CAAA,MAAA8B,QAAA,CAAAjB,IAAA,CAAAd,CAAA,EAAAgC,KAAA,6BAAA/B,CAAA,IAAAD,CAAA,CAAAiC,WAAA,KAAAhC,CAAA,GAAAD,CAAA,CAAAiC,WAAA,CAAAC,IAAA,aAAAjC,CAAA,cAAAA,CAAA,GAAAqB,KAAA,CAAAa,IAAA,CAAAnC,CAAA,oBAAAC,CAAA,+CAAAmC,IAAA,CAAAnC,CAAA,IAAA6B,iBAAA,CAAA9B,CAAA,EAAAQ,CAAA;AAAA,SAAAsB,kBAAA9B,CAAA,EAAAQ,CAAA,aAAAA,CAAA,IAAAA,CAAA,GAAAR,CAAA,CAAAyB,MAAA,MAAAjB,CAAA,GAAAR,CAAA,CAAAyB,MAAA,YAAA3B,CAAA,MAAAQ,CAAA,GAAAgB,KAAA,CAAAd,CAAA,GAAAV,CAAA,GAAAU,CAAA,EAAAV,CAAA,IAAAQ,CAAA,CAAAR,CAAA,IAAAE,CAAA,CAAAF,CAAA,UAAAQ,CAAA;AAAA,SAE5B+B,aAAaA,CAAAC,EAAA;EAAA,OAAAC,cAAA,CAAAC,KAAA,OAAAC,SAAA;AAAA,EAkG3C;AACA;AACA;AACA;AACA;AACA;AACA;AAAA,SAAAF,eAAA;EAAAA,cAAA,OAAAG,kBAAA,0BAAAC,YAAA,YAAAC,IAAA,CAxGe,SAAAC,QAA6BC,IAAI;IAAA,IAAAC,IAAA;MAAAC,QAAA;MAAAC,MAAA;MAAAC,SAAA;MAAAC,UAAA;MAAAC,MAAA;MAAAC,OAAA;MAAAC,MAAA;MAAAC,WAAA;MAAAC,cAAA;MAAAC,UAAA;MAAAC,QAAA;MAAAC,WAAA;MAAAC,eAAA;MAAAC,kBAAA;MAAAC,aAAA;MAAAC,WAAA;MAAAC,UAAA;MAAAC,OAAA;MAAAC,eAAA;MAAAC,MAAA;MAAAC,gBAAA;MAAAC,SAAA;MAAAC,IAAA;MAAAC,EAAA;MAAAC,SAAA;MAAAC,YAAA;MAAAC,gBAAA;MAAAC,KAAA;MAAAC,cAAA;MAAAC,kBAAA;MAAAC,QAAA;MAAAC,UAAA;MAAAC,MAAA;MAAAC,YAAA;MAAAC,EAAA;MAAAC,KAAA;MAAAC,OAAA;MAAAC,UAAA;MAAAC,MAAA;MAAAC,KAAA;MAAAC,0BAAA;MAAAC,aAAA;MAAAC,KAAA,GAAAjD,SAAA;IAAA,OAAAE,YAAA,YAAAgD,IAAA,UAAAC,SAAAC,QAAA;MAAA,kBAAAA,QAAA,CAAAC,IAAA,GAAAD,QAAA,CAAAzE,IAAA;QAAA;UAAA2B,IAAA,GAAA2C,KAAA,CAAAjE,MAAA,QAAAiE,KAAA,QAAAK,SAAA,GAAAL,KAAA,MAkB5C,CAAC,CAAC,EAjBL1C,QAAQ,GAAAD,IAAA,CAARC,QAAQ,EACRC,MAAM,GAAAF,IAAA,CAANE,MAAM,EACCC,SAAS,GAAAH,IAAA,CAAhBiD,KAAK,EACG7C,UAAU,GAAAJ,IAAA,CAAlBoB,MAAM,EACNf,MAAM,GAAAL,IAAA,CAANK,MAAM,EACNC,OAAO,GAAAN,IAAA,CAAPM,OAAO,EACPC,MAAM,GAAAP,IAAA,CAANO,MAAM,EACNC,WAAW,GAAAR,IAAA,CAAXQ,WAAW,EACXC,cAAc,GAAAT,IAAA,CAAdS,cAAc,EACdC,UAAU,GAAAV,IAAA,CAAVU,UAAU,EACVC,QAAQ,GAAAX,IAAA,CAARW,QAAQ,EACRC,WAAW,GAAAZ,IAAA,CAAXY,WAAW,EACXC,eAAe,GAAAb,IAAA,CAAfa,eAAe,EACfC,kBAAkB,GAAAd,IAAA,CAAlBc,kBAAkB,EAClBC,aAAa,GAAAf,IAAA,CAAbe,aAAa,EACbC,WAAW,GAAAhB,IAAA,CAAXgB,WAAW,EACXC,UAAU,GAAAjB,IAAA,CAAViB,UAAU;UAEV;UACA;UACMC,OAAO,GAAG,IAAIgC,mBAAO,CAACjD,QAAQ,CAAC;UAAAkB,eAAA,GAMjC,IAAAgC,mCAAc,EAAC;YAClBpD,IAAI,EAAJA,IAAI;YACJI,SAAS,EAATA,SAAS;YACTC,UAAU,EAAVA,UAAU;YACVC,MAAM,EAANA,MAAM;YACNC,OAAO,EAAPA,OAAO;YACPC,MAAM,EAANA,MAAM;YACNC,WAAW,EAAXA,WAAW;YACXC,cAAc,EAAdA,cAAc;YACdC,UAAU,EAAVA,UAAU;YACVC,QAAQ,EAARA,QAAQ;YACRC,WAAW,EAAXA,WAAW;YACXC,eAAe,EAAfA,eAAe;YACfC,kBAAkB,EAAlBA,kBAAkB;YAClBC,aAAa,EAAbA,aAAa;YACbC,WAAW,EAAXA,WAAW;YACXC,UAAU,EAAVA;UACD,CAAC,CAAC,EApBDG,MAAM,GAAAD,eAAA,CAANC,MAAM,EACNC,gBAAgB,GAAAF,eAAA,CAAhBE,gBAAgB,EAChBC,SAAS,GAAAH,eAAA,CAATG,SAAS,EAoBV;UACA;UACA;UAAAwB,QAAA,CAAAzE,IAAA;UAAA,OACmB+E,mBAAmB,CAAC,CAAC;QAAA;UAAlC7B,IAAI,GAAAuB,QAAA,CAAAO,IAAA;UAAAP,QAAA,CAAAzE,IAAA;UAAA,OACOiF,eAAe,CAACC,gBAAI,CAACC,IAAI,CAACjC,IAAI,EAAE,IAAI,CAAC,CAAC;QAAA;UAAjDC,EAAE,GAAAsB,QAAA,CAAAO,IAAA;UAAAP,QAAA,CAAAzE,IAAA;UAAA,OACgBiF,eAAe,CAACC,gBAAI,CAACC,IAAI,CAAChC,EAAE,EAAE,OAAO,CAAC,CAAC;QAAA;UAAzDC,SAAS,GAAAqB,QAAA,CAAAO,IAAA;UAAAP,QAAA,CAAAzE,IAAA;UAAA,OACYiF,eAAe,CAACC,gBAAI,CAACC,IAAI,CAAChC,EAAE,EAAE,UAAU,CAAC,CAAC;QAAA;UAA/DE,YAAY,GAAAoB,QAAA,CAAAO,IAAA;UAAAP,QAAA,CAAAzE,IAAA;UAAA,OACaiF,eAAe,CAACC,gBAAI,CAACC,IAAI,CAAC9B,YAAY,EAAE,OAAO,CAAC,CAAC;QAAA;UAA1EC,gBAAgB,GAAAmB,QAAA,CAAAO,IAAA;UAAAP,QAAA,CAAAzE,IAAA;UAAA,OACFiF,eAAe,CAACC,gBAAI,CAACC,IAAI,CAAChC,EAAE,EAAE,OAAO,CAAC,CAAC;QAAA;UAArDI,KAAK,GAAAkB,QAAA,CAAAO,IAAA;UAAAP,QAAA,CAAAzE,IAAA;UAAA,OACkBiF,eAAe,CAACC,gBAAI,CAACC,IAAI,CAAChC,EAAE,EAAE,YAAY,CAAC,CAAC;QAAA;UAAnEK,cAAc,GAAAiB,QAAA,CAAAO,IAAA;UAAAP,QAAA,CAAAzE,IAAA;UAAA,OACaiF,eAAe,CAACC,gBAAI,CAACC,IAAI,CAAC3B,cAAc,EAAE,OAAO,CAAC,CAAC;QAAA;UAA9EC,kBAAkB,GAAAgB,QAAA,CAAAO,IAAA;UAElBtB,QAAQ,GAAG,CAChB0B,SAAS,CAACF,gBAAI,CAACC,IAAI,CAAC5B,KAAK,EAAE,mBAAmB,CAAC,EAAE,IAAA8B,2BAAuB,EAAC;YAAEtC,MAAM,EAANA;UAAO,CAAC,CAAC,CAAC,EACrFqC,SAAS,CAACF,gBAAI,CAACC,IAAI,CAAChC,EAAE,EAAE,cAAc,CAAC,EAAE,IAAAmC,uBAAmB,EAAC;YAAEvC,MAAM,EAANA,MAAM;YAAEP,eAAe,EAAfA,eAAe;YAAEC,kBAAkB,EAAlBA;UAAmB,CAAC,CAAC,CAAC,EAC9G2C,SAAS,CAACF,gBAAI,CAACC,IAAI,CAAChC,EAAE,EAAE,YAAY,CAAC,EAAE,IAAAoC,qBAAiB,EAACtC,SAAS,CAAC,CAAC,CAAC,CAAC,EACtEmC,SAAS,CAACF,gBAAI,CAACC,IAAI,CAAChC,EAAE,EAAE,mBAAmB,CAAC,EAAE,IAAAqC,4BAAwB,EAACxC,gBAAgB,CAAC,CAAC,CAAC,CAAC,CAC3F;UAED,KAAAW,UAAA,GAAA9D,+BAAA,CAAmCkD,MAAM,KAAAa,MAAA,GAAAD,UAAA,IAAApD,IAAA,GAAE;YAAAsD,YAAA,GAAAD,MAAA,CAAApD,KAAA,EAA9BsD,EAAE,GAAAD,YAAA,CAAFC,EAAE,EAAEpC,KAAI,GAAAmC,YAAA,CAAJnC,IAAI,EAAEQ,OAAM,GAAA2B,YAAA,CAAN3B,MAAM;YAC5BwB,QAAQ,CAAC+B,IAAI,CAACL,SAAS,CAACF,gBAAI,CAACC,IAAI,CAAC3B,cAAc,UAAAkC,MAAA,CAAU5B,EAAE,SAAM,CAAC,EAAEpC,KAAI,CAAC,CAAC;YAC3EgC,QAAQ,CAAC+B,IAAI,CAACL,SAAS,CAACF,gBAAI,CAACC,IAAI,CAAC1B,kBAAkB,UAAAiC,MAAA,CAAU5B,EAAE,cAAW,CAAC,EAAE,IAAA6B,wBAAoB,EAAC;cAAE7B,EAAE,EAAFA,EAAE;cAAE5B,MAAM,EAANA;YAAO,CAAC,CAAC,CAAC,CAAC;YACpH,IAAIA,OAAM,EAAE;cACXwB,QAAQ,CAAC+B,IAAI,CAACL,SAAS,CAACF,gBAAI,CAACC,IAAI,CAAC9B,YAAY,YAAAqC,MAAA,CAAY5B,EAAE,SAAM,CAAC,EAAE,IAAA8B,sBAAkB,EAAC;gBAAE1D,MAAM,EAANA;cAAO,CAAC,CAAC,CAAC,CAAC;cACrGwB,QAAQ,CAAC+B,IAAI,CAACL,SAAS,CAACF,gBAAI,CAACC,IAAI,CAAC7B,gBAAgB,YAAAoC,MAAA,CAAY5B,EAAE,cAAW,CAAC,EAAE,IAAA+B,0BAAsB,EAAC;gBAAE3D,MAAM,EAANA,OAAM;gBAAE4D,OAAO,EAAEhC;cAAG,CAAC,CAAC,CAAC,CAAC;cAC/H;cACA,KAAAG,UAAA,GAAApE,+BAAA,CAAoBqC,OAAM,KAAAgC,MAAA,GAAAD,UAAA,IAAA1D,IAAA,GAAE;gBAAjB4D,KAAK,GAAAD,MAAA,CAAA1D,KAAA;gBACT4D,0BAA0B,GAAG2B,iBAAiB,CAAC5B,KAAK,CAAC6B,OAAO,CAAC;gBAC7D3B,aAAa,GAAGa,gBAAI,CAACC,IAAI,CAAC/B,SAAS,EAAE,IAAA6C,4BAAgB,EAAC9B,KAAK,EAAE;kBAAE2B,OAAO,EAAEhC,EAAE;kBAAEoC,WAAW,EAAEhE;gBAAO,CAAC,CAAC,CAAC;gBACzGwB,QAAQ,CAAC+B,IAAI,CAACU,mBAAmB,CAAC9B,aAAa,EAAED,0BAA0B,CAAC,CAAC;cAC9E;YACD;UACD;UAACK,QAAA,CAAAzE,IAAA;UAAA,OAEKoG,OAAO,CAACC,GAAG,CAAC3C,QAAQ,CAAC;QAAA;UAE3Bb,OAAO,CAACyD,SAAS,CAACnD,EAAE,EAAE,IAAI,CAAC;UAE3BN,OAAO,CAAC0D,MAAM,CAACC,iBAAI,EAAE,aAAa,CAAC;UAElC3D,OAAO,CAAC0D,MAAM,CAAC,IAAAE,4BAAuB,EAAC;YAAEvE,MAAM,EAANA,MAAM;YAAEa,MAAM,EAANA;UAAO,CAAC,CAAC,EAAE,qBAAqB,CAAC;UAAA,KAE/EnB,QAAQ;YAAA6C,QAAA,CAAAzE,IAAA;YAAA;UAAA;UAAAyE,QAAA,CAAAzE,IAAA;UAAA,OACL6C,OAAO,CAAC6D,KAAK,CAAC,CAAC;QAAA;UAAAjC,QAAA,CAAAzE,IAAA;UAAA,OACf2G,4CAA4C,CAACzD,IAAI,CAAC;QAAA;UAAAuB,QAAA,CAAAzE,IAAA;UAAA;QAAA;UAAA,KAC9C6B,MAAM;YAAA4C,QAAA,CAAAzE,IAAA;YAAA;UAAA;UAAA,OAAAyE,QAAA,CAAAmC,MAAA,WACTC,cAAc,CAAChE,OAAO,CAAC6D,KAAK,CAAC,CAAC,CAAC;QAAA;UAAA,OAAAjC,QAAA,CAAAmC,MAAA,WAE/B/D,OAAO,CAAC6D,KAAK,CAAC,CAAC;QAAA;QAAA;UAAA,OAAAjC,QAAA,CAAAqC,IAAA;MAAA;IAAA,GAAArF,OAAA;EAAA,CAEvB;EAAA,OAAAN,cAAA,CAAAC,KAAA,OAAAC,SAAA;AAAA;AASD,SAAS+D,SAASA,CAACF,IAAI,EAAE6B,QAAQ,EAAE;EAClC,OAAO,IAAIX,OAAO,CAAC,UAACY,OAAO,EAAEC,MAAM,EAAK;IACvCC,cAAE,CAAC9B,SAAS,CAACF,IAAI,EAAE6B,QAAQ,EAAE,OAAO,EAAE,UAACI,KAAK,EAAK;MAChD,IAAIA,KAAK,EAAE;QACV,OAAOF,MAAM,CAACE,KAAK,CAAC;MACrB;MACAH,OAAO,CAAC,CAAC;IACV,CAAC,CAAC;EACH,CAAC,CAAC;AACH;AAEA,SAAS/B,eAAeA,CAACC,IAAI,EAAE;EAC9B,OAAO,IAAIkB,OAAO,CAAC,UAACY,OAAO,EAAEC,MAAM,EAAK;IACvCC,cAAE,CAACE,KAAK,CAAClC,IAAI,EAAE,UAACiC,KAAK,EAAK;MACzB,IAAIA,KAAK,EAAE;QACV,OAAOF,MAAM,CAACE,KAAK,CAAC;MACrB;MACAH,OAAO,CAAC9B,IAAI,CAAC;IACd,CAAC,CAAC;EACH,CAAC,CAAC;AACH;AAEA,SAASH,mBAAmBA,CAAA,EAAG;EAC9B,OAAO,IAAIqB,OAAO,CAAC,UAACY,OAAO,EAAEC,MAAM,EAAK;IACvCC,cAAE,CAACG,OAAO,CAACnC,gBAAI,CAACC,IAAI,CAACmC,cAAE,CAACC,MAAM,CAAC,CAAC,EAAE,mBAAmB,CAAC,EAAE,UAACJ,KAAK,EAAEK,aAAa,EAAK;MACjF,IAAIL,KAAK,EAAE;QACV,OAAOF,MAAM,CAACE,KAAK,CAAC;MACrB;MACAH,OAAO,CAACQ,aAAa,CAAC;IACvB,CAAC,CAAC;EACH,CAAC,CAAC;AACH;AAEA,SAASb,4CAA4CA,CAACzB,IAAI,EAAE;EAC3D,IAAIgC,cAAE,CAACO,EAAE,EAAE;IACV,OAAOC,eAAe,CAACxC,IAAI,CAAC;EAC7B,CAAC,MAAM;IACNyC,yBAAyB,CAACzC,IAAI,CAAC;IAC9B,OAAOkB,OAAO,CAACY,OAAO,CAAC,CAAC;EAC1B;AACD;;AAEA;AACA,SAASU,eAAeA,CAACxC,IAAI,EAAE;EAC9B,OAAO,IAAIkB,OAAO,CAAC,UAACY,OAAO,EAAEC,MAAM,EAAK;IACvCC,cAAE,CAACO,EAAE,CAACvC,IAAI,EAAE;MAAE0C,SAAS,EAAE,IAAI;MAAEC,KAAK,EAAE;IAAK,CAAC,EAAE,UAACV,KAAK,EAAK;MACxD,IAAIA,KAAK,EAAE;QACV,OAAOF,MAAM,CAACE,KAAK,CAAC;MACrB;MACAH,OAAO,CAAC,CAAC;IACV,CAAC,CAAC;EACH,CAAC,CAAC;AACH;;AAEA;AACA,SAASW,yBAAyBA,CAACH,aAAa,EAAE;EAChD,IAAMM,UAAU,GAAGZ,cAAE,CAACa,WAAW,CAACP,aAAa,CAAC;EAChD,SAAAQ,SAAA,GAAAnI,+BAAA,CAAwBiI,UAAU,GAAAG,KAAA,IAAAA,KAAA,GAAAD,SAAA,IAAAzH,IAAA,GAAE;IAAA,IAAzB2H,SAAS,GAAAD,KAAA,CAAAzH,KAAA;IAClB,IAAM2H,SAAS,GAAGjD,gBAAI,CAACC,IAAI,CAACqC,aAAa,EAAEU,SAAS,CAAC;IACrD,IAAME,KAAK,GAAGlB,cAAE,CAACmB,QAAQ,CAACF,SAAS,CAAC;IACpC,IAAIA,SAAS,KAAK,GAAG,IAAIA,SAAS,KAAK,IAAI,EAAE;MAC3C;IAAA,CACD,MAAM,IAAIC,KAAK,CAACE,WAAW,CAAC,CAAC,EAAE;MAC9B;MACAX,yBAAyB,CAACQ,SAAS,CAAC;IACtC,CAAC,MAAM;MACL;MACAjB,cAAE,CAACqB,UAAU,CAACJ,SAAS,CAAC;IAC1B;EACF;EACAjB,cAAE,CAACsB,SAAS,CAAChB,aAAa,CAAC;AAC7B;;AAEA;AACA,SAASX,cAAcA,CAAC4B,MAAM,EAAE;EAC/B,OAAO,IAAIrC,OAAO,CAAC,UAACY,OAAO,EAAEC,MAAM,EAAK;IACvC,IAAMyB,MAAM,GAAG,EAAE;IACjBD,MAAM,CAACE,EAAE,CAAC,MAAM,EAAE,UAACC,KAAK;MAAA,OAAKF,MAAM,CAACjD,IAAI,CAACmD,KAAK,CAAC;IAAA,EAAC;IAChDH,MAAM,CAACE,EAAE,CAAC,KAAK,EAAE;MAAA,OAAM3B,OAAO,CAAC6B,MAAM,CAACnD,MAAM,CAACgD,MAAM,CAAC,CAAC;IAAA,EAAC;IACtDD,MAAM,CAACE,EAAE,CAAC,OAAO,EAAE1B,MAAM,CAAC;EAC3B,CAAC,CAAC;AACH;AAEA,SAAS6B,QAAQA,CAACC,QAAQ,EAAEC,MAAM,EAAE;EACnC,OAAO,IAAI5C,OAAO,CAAC,UAACY,OAAO,EAAEC,MAAM,EAAK;IACvCC,cAAE,CAAC4B,QAAQ,CAACC,QAAQ,EAAEC,MAAM,EAAE,UAAC7B,KAAK,EAAK;MACxC,IAAIA,KAAK,EAAE;QACV,OAAOF,MAAM,CAACE,KAAK,CAAC;MACrB;MACAH,OAAO,CAAC,CAAC;IACV,CAAC,CAAC;EACH,CAAC,CAAC;AACH;AAEA,SAASjB,iBAAiBA,CAACkD,MAAM,EAAE;EAClC,IAAIA,MAAM,YAAYC,kBAAM,EAAE;IAC7B,OAAOD,MAAM;EACd;EACA,IAAIA,MAAM,YAAYJ,MAAM,EAAE;IAC7B,OAAOM,gBAAQ,CAACpI,IAAI,CAACkI,MAAM,CAAC;EAC7B;EACA,IAAI,OAAOA,MAAM,KAAK,QAAQ,EAAE;IAC/B,OAAO/B,cAAE,CAACkC,gBAAgB,CAACH,MAAM,CAAC;EACnC;EACA,MAAM,IAAII,KAAK,CAAC,uEAAuE,CAAC;AACzF;AAEA,SAASlD,mBAAmBA,CAACvE,QAAQ,EAAE0H,cAAc,EAAE;EACtD,IAAMC,cAAc,GAAGrC,cAAE,CAACsC,iBAAiB,CAAC5H,QAAQ,CAAC;EACrD0H,cAAc,CAACG,IAAI,CAACF,cAAc,CAAC;EACnC,OAAO,IAAInD,OAAO,CAAC,UAAAY,OAAO;IAAA,OAAIuC,cAAc,CAACZ,EAAE,CAAC,QAAQ,EAAE3B,OAAO,CAAC;EAAA,EAAC;AACpE","ignoreList":[]}