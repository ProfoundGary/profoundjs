{"version":3,"file":"drawing.xml.js","names":["_sanitizeAttributeValue","_interopRequireDefault","require","e","__esModule","_createForOfIteratorHelperLoose","r","t","Symbol","iterator","call","next","bind","Array","isArray","_unsupportedIterableToArray","length","o","done","value","TypeError","a","_arrayLikeToArray","toString","slice","constructor","name","from","test","n","generateDrawingXml","_ref","images","output","i","_loop","image","_step","imageId","pxToEmu","px","pxToEmu_","dpi","concat","anchor","column","offsetX","row","offsetY","width","height","title","$attr","description","_iterator","DEFAULT_DISPLAY_DPI","DEFAULT_IMAGE_DPI","imageDpi","displayDpi","Math","round"],"sources":["../../../source/write/files/drawing.xml.js"],"sourcesContent":["import $attr from '../../xml/sanitizeAttributeValue.js'\r\n\r\n// https://gitlab.com/catamphetamine/write-excel-file/-/blob/main/docs/IMAGES.md\r\nexport default function generateDrawingXml({ images }) {\r\n\tlet output = '<?xml version=\"1.0\" encoding=\"UTF-8\" standalone=\"yes\"?>' +\r\n\t\t'<xdr:wsDr xmlns:xdr=\"http://schemas.openxmlformats.org/drawingml/2006/spreadsheetDrawing\" xmlns:a=\"http://schemas.openxmlformats.org/drawingml/2006/main\">'\r\n\r\n\tlet i = 0\r\n\tfor (const image of images) {\r\n\t\t// The `rId` of the image in `drawing.xml.rels` file.\r\n\t\tconst imageId = i + 1\r\n\r\n\t\tconst pxToEmu = (px) => pxToEmu_(px, image.dpi)\r\n\r\n\t\t// There're two ways an image could be \"anchored\" in a spreadsheet:\r\n\t\t// * One-cell anchor — \"anchors\" the image's top-left corner to a top-left corner of a cell.\r\n\t\t// * Two-cell anchor — \"anchors\" the image's top-left corner to a top-left corner of the first cell,\r\n\t\t//   and then the image's bottom-right corner to the bottom-right corner of the second cell.\r\n\t\t//   While doing so, it completely ignores the image's aspect ratio, so there seems to be\r\n\t\t//   no equivalent for CSS's `object-fit: contain` behavior.\r\n\t\toutput += '<xdr:oneCellAnchor>'\r\n\r\n\t\toutput += '<xdr:from>'\r\n\t\toutput += `<xdr:col>${image.anchor.column - 1}</xdr:col>`\r\n\t\toutput += `<xdr:colOff>${typeof image.offsetX === 'number' ? pxToEmu(image.offsetX) : 0}</xdr:colOff>`\r\n\t\toutput += `<xdr:row>${image.anchor.row - 1}</xdr:row>`\r\n\t\toutput += `<xdr:rowOff>${typeof image.offsetY === 'number' ? pxToEmu(image.offsetY) : 0}</xdr:rowOff>`\r\n\t\toutput += '</xdr:from>'\r\n\r\n\t\toutput += `<xdr:ext cx=\"${pxToEmu(image.width)}\" cy=\"${pxToEmu(image.height)}\"/>`\r\n\r\n\t\toutput += '<xdr:pic>'\r\n\r\n\t\toutput += '<xdr:nvPicPr>'\r\n\r\n\t\toutput += `<xdr:cNvPr id=\"${imageId}\" name=\"${image.title ? $attr(image.title) : 'Picture ' + imageId}\" descr=\"${image.description ? $attr(image.description) : ''}\"/>`\r\n\r\n\t\toutput += '<xdr:cNvPicPr>'\r\n    // Optional XML element. Locks the aspect ratio of the image. -->\r\n    output += '<a:picLocks noChangeAspect=\"1\"/>'\r\n\t\toutput += '</xdr:cNvPicPr>'\r\n\r\n\t\toutput += '</xdr:nvPicPr>'\r\n\r\n\t\toutput += '<xdr:blipFill>';\r\n\r\n\t\t// The link to the image.\r\n\t\toutput += `<a:blip xmlns:r=\"http://schemas.openxmlformats.org/officeDocument/2006/relationships\" r:embed=\"rId${imageId}\" cstate=\"print\"/>`;\r\n\r\n\t\t// Allows scaling the image.\r\n\t\toutput += '<a:stretch>'\r\n\t\toutput += '<a:fillRect/>'\r\n\t\toutput += '</a:stretch>'\r\n\r\n\t\toutput += '</xdr:blipFill>'\r\n\r\n\t\t// Dunno what this is.\r\n\t\toutput += '<xdr:spPr>'\r\n\r\n\t\toutput += '<a:prstGeom prst=\"rect\">'\r\n\t\toutput += '<a:avLst/>'\r\n\t\toutput += '</a:prstGeom>'\r\n\r\n\t\toutput += '</xdr:spPr>'\r\n\r\n\t\toutput += '</xdr:pic>'\r\n\r\n\t\toutput += '<xdr:clientData/>';\r\n\r\n\t\toutput += '</xdr:oneCellAnchor>';\r\n\r\n\t\ti++;\r\n\t}\r\n\r\n\toutput += '</xdr:wsDr>';\r\n\r\n\treturn output;\r\n}\r\n\r\n// For legacy reasons, XLSX documents measure image dimensions not in pixels\r\n// but rather in a weird measurement unit called EMU (English Metric Unit).\r\n// https://gitlab.com/catamphetamine/write-excel-file/-/blob/main/docs/IMAGES.md#image-dimensions\r\n// This function converts pixels to EMUs.\r\nconst DEFAULT_DISPLAY_DPI = 96\r\nconst DEFAULT_IMAGE_DPI = 96\r\nfunction pxToEmu_(px, imageDpi) {\r\n\tconst displayDpi = DEFAULT_DISPLAY_DPI\r\n\treturn Math.round(px * 9525 * (DEFAULT_DISPLAY_DPI / displayDpi) * (DEFAULT_IMAGE_DPI / imageDpi))\r\n}"],"mappings":"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","ignoreList":[]}